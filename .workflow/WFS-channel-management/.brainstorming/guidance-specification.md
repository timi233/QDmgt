# 分销商渠道管理系统 - 确认指导规范

**Metadata**
- 生成时间: 2025-11-21
- 项目类型: 全新项目
- 核心关注: 销售管理分销商渠道信息 + 领导查看数据总览
- 参与角色: system-architect, product-manager, ux-expert, data-architect, ui-designer
- 业务背景: 渠道主要指下游分销商渠道

---

## 1. 项目定位与目标

### CONFIRMED 目标
**项目使命**: 为销售团队提供分销商渠道信息管理工具，为领导层提供实时数据总览看板

**CONFIRMED 使用规模**: 小团队(10-30人销售 + 少数领导)
- **影响**: 单体架构足够，快速开发，简单部署
- **技术要求**: 无需复杂的微服务架构和分布式系统

**CONFIRMED 核心诉求**: 销售-领导协同工作流
- **销售需求**: 快速录入和查询分销商渠道信息
- **领导需求**: 实时数据看板和趋势分析
- **协同需求**: 渠道跟进流程和任务提醒机制

**CONFIRMED 交付策略**: 功能完整性一次性交付
- **开发周期**: 6-8周完整交付
- **功能范围**: 渠道CRUD + 看板 + 任务跟进一次性完成
- **适用场景**: 需求明确，风险可控

**CONFIRMED 数据实时性**: 准实时更新(1-5分钟延迟可接受)
- **更新方式**: 后台定时任务 + 缓存
- **技术选型**: 平衡性能和复杂度
- **用户体验**: 领导看板数据延迟1-5分钟，业务可接受

---

## 2. 系统架构师决策

### SELECTED 技术架构

**整体架构**: 前后端分离单体架构
- **理由**: 前端SPA + 后端单一服务，部署简单，适合小团队快速开发
- **扩展性**: 后期可按模块拆分为微服务
- **技术栈**: React/Vue3 + Node.js/Python后端

**准实时数据同步**: 定时任务(Cron) + Redis缓存
- **理由**: 后台每分钟统计数据写入Redis，看板从缓存读取，简单可靠
- **实现方式**: Cron Job定时聚合 → Redis存储 → 看板读取缓存
- **性能**: 满足1-5分钟准实时需求，看板查询无数据库压力

**数据库选型**: PostgreSQL
- **理由**: 强大的JSON支持和聚合查询，适合复杂统计，开源生态成熟
- **扩展字段支持**: JSONB字段存储灵活扩展信息
- **事务支持**: ACID保证数据一致性

**部署方案**: Docker Compose单机部署
- **理由**: 适合小团队，快速部署，成本低，单点故障风险可接受
- **容器化**: PostgreSQL + Redis + 后端服务 + Nginx
- **备份策略**: 定期数据库备份即可

### 跨角色整合点

**事件流与缓存集成** (与data-architect协调):
- **CONFIRMED 方案**: 事件流仅用于审计日志，业务数据用传统表+定时聚合
- **职责分离**: 事件表独立存储操作记录，不影响业务查询性能
- **审计能力**: 所有关键操作(创建/修改/删除分销商，分配任务)记录到事件流表
- **业务查询**: 分销商和任务使用传统关系表，定时任务聚合到Redis

---

## 3. 产品经理决策

### SELECTED 产品范围

**功能模块**: 渠道管理 + 领导看板 + 基础权限
- **理由**: 满足基本需求，开发周期6-8周，风险可控
- **核心功能**: 分销商CRUD、任务分配跟进、数据统计看板、用户权限控制
- **MVP边界**: 不包含移动端、复杂工作流审批、高级数据分析

**工作流设计**: 任务分配+进度跟踪
- **理由**: 领导分配渠道给销售，设置跟进任务和截止时间，销售反馈进度
- **核心流程**:
  1. 领导在分销商详情页创建跟进任务
  2. 分配给指定销售，设置截止时间和优先级
  3. 销售在工作台查看任务，更新进度和备注
  4. 领导在看板查看整体任务完成情况

**看板指标**: 渠道总览(总数/新增/成交率/区域分布)
- **理由**: 宏观统计数据，快速了解整体情况
- **核心指标**:
  - 分销商总数、本月新增数量
  - 成交率(已合作/总数)
  - 区域分布(按省份/城市统计)
  - 趋势图表(月度新增趋势)

**权限设计**: 销售只能管理自己的渠道，领导可查看所有渠道
- **理由**: 数据隔离，销售只看自己负责的分销商，领导全局视野
- **权限矩阵**:
  - 销售: 查看/编辑自己负责的分销商，查看分配给自己的任务
  - 领导: 查看所有分销商，创建/分配任务，查看全局看板
- **实现方式**: 应用层WHERE条件过滤(与data-architect协调)

---

## 4. UX专家决策

### SELECTED 用户体验设计

**分销商录入表单**: 分步表单(基础信息→联系方式→合作详情)
- **理由**: 降低认知负担，引导逐步完善信息
- **步骤设计**:
  - 第一步: 必填基础信息(名称、地址、合作等级)
  - 第二步: 联系方式+合作信息(联系人、电话、授信额度、标签)
  - 第三步: 可选的历史业绩和备注(支持快速录入后跳过)
- **整合点**: 与data-architect扩展字段模型匹配(Phase 4澄清)

**任务分配交互**: 分销商详情页内分配任务
- **理由**: 分配时能看到完整分销商背景，决策准确
- **操作流程**: 领导查看分销商详情 → 点击"创建跟进任务" → 填写任务内容、选择销售、设置截止时间

**领导看板展示**: 数据表格+筛选器
- **理由**: 信息密度高，支持下钻分析，适合细节查看
- **交互特性**:
  - 支持按区域/状态/负责销售筛选
  - 支持排序和搜索
  - 点击行查看分销商详情

**销售工作台**: 任务优先视图(今日任务→本周任务→分销商列表)
- **理由**: 以待办为核心，提醒销售优先处理紧急任务
- **布局**: 分组列表形式，今日任务(折叠/展开)→明日任务(折叠/展开)→本周任务(Phase 4澄清)

### 跨角色整合点

**任务导航路径** (与product-manager协调):
- **CONFIRMED 方案**: 任务卡片内嵌分销商摘要信息，点击跳转到分销商详情页
- **用户体验**: 标准页面跳转流程，需要返回按钮
- **任务卡片内容**: 分销商名称、联系人、任务描述、截止时间、优先级

---

## 5. 数据架构师决策

### SELECTED 数据模型

**分销商数据模型**: 扩展模型
- **核心字段**: id, name, contact_person, phone, address, region, status, owner_user_id, created_at, updated_at
- **扩展字段**:
  - cooperation_level: 合作等级(A/B/C级)
  - credit_limit: 授信额度(数值)
  - historical_performance: 历史业绩(JSON)
  - tags: 标签(数组)
- **理由**: 支持精细化管理，便于后续分析和筛选

**任务关联设计**: 事件流模型(所有操作记录为事件流)
- **事件表结构**:
  - event_id, event_type, entity_type, entity_id, user_id, payload(JSON), timestamp
- **事件类型**: distributor_created, distributor_updated, task_created, task_assigned, task_completed
- **业务表**: 传统关系表存储当前状态(distributors表、tasks表)
- **整合点**: 与system-architect协调，事件流仅用于审计，不影响业务查询(Phase 4澄清)

**看板数据计算**: 定时聚合(每分钟后台任务计算存入Redis)
- **聚合逻辑**:
  - 后台Cron Job每分钟执行聚合SQL
  - 计算各项指标(总数、新增、成交率、区域分布)
  - 结果写入Redis(key: dashboard:stats, TTL: 5分钟)
- **Redis数据结构**: Hash存储各指标，支持独立更新
- **查询性能**: 看板直接从Redis读取，毫秒级响应

**数据权限隔离**: 应用层过滤
- **实现方式**: 所有分销商查询SQL添加WHERE owner_user_id = current_user_id条件
- **安全策略**:
  - ORM层封装通用查询方法，自动注入权限过滤
  - 领导角色跳过权限过滤(通过role判断)
- **理由**: 灵活可控，便于调试和特殊场景处理

### 跨角色整合点

**扩展字段在分步表单中的分布** (与ux-expert协调):
- **CONFIRMED 映射**:
  - 第一步: name, address, cooperation_level(必填)
  - 第二步: contact_person, phone, credit_limit, tags
  - 第三步: historical_performance(可选), notes(可选)
- **理由**: 前两步快速完成核心信息，第三步可跳过，支持快速录入后续补全

---

## 6. UI设计师决策

### SELECTED 视觉设计

**整体风格**: 清爽简约风格(浅色主题+高对比度)
- **理由**: 现代感强，信息层次清晰，适合长时间使用，易读性好
- **配色方案**:
  - 主色: 蓝色(#1890ff) - 品牌色和主操作按钮
  - 辅助色: 绿色(成功)、橙色(警告)、红色(错误/紧急)
  - 背景: 白色/浅灰色渐变
- **字体**: 系统默认无衬线字体，标题16-20px，正文14px

**分步表单步骤指示器**: 顶部横向步骤条(数字+文字标签)
- **理由**: 进度清晰，符合用户心智模型，标准设计
- **样式**:
  - 已完成步骤: 蓝色圆圈+对勾
  - 当前步骤: 蓝色圆圈+高亮文字
  - 未完成步骤: 灰色圆圈+灰色文字
- **位置**: 表单顶部居中，占用高度60px

**数据表格看板**: 标准表格+筛选器+分页
- **理由**: 信息密度高，支持排序和搜索，企业管理系统标准方案
- **组件**: Ant Design Table组件
- **特性**:
  - 固定表头，内容区域滚动
  - 列宽可调整
  - 行hover高亮
  - 奇偶行背景色区分

**任务工作台布局**: 分组列表视图
- **理由**: 折叠控制信息密度，适合任务量不均的场景(与Phase 4澄清对齐)
- **分组结构**:
  - 今日任务(默认展开，红色标签)
  - 明日任务(默认折叠，橙色标签)
  - 本周任务(默认折叠，蓝色标签)
- **任务卡片**:
  - 左侧优先级色条(红/橙/蓝)
  - 标题+分销商摘要信息
  - 截止时间+负责销售

### 跨角色整合点

**时间轴视图的具体呈现** (与ux-expert协调):
- **CONFIRMED 方案**: 分组列表：今日任务(折叠/展开)→明日任务(折叠/展开)→本周任务
- **交互行为**: 点击分组标题切换折叠/展开状态，记住用户偏好
- **视觉层次**: 使用卡片阴影和间距区分不同分组

---

## 跨角色整合总结

### CONFIRMED 整合点

**1. 数据架构整合** (system-architect + data-architect)
- **事件流定位**: 仅用于审计日志，业务查询使用传统关系表
- **缓存策略**: 定时任务从关系表聚合数据到Redis，看板读取缓存
- **数据流**: 业务操作 → 写入关系表 + 记录事件流 → 定时任务聚合 → Redis缓存 → 看板展示

**2. 表单字段映射** (ux-expert + data-architect)
- **三步表单字段分布**:
  - 第一步(必填): 名称、地址、合作等级
  - 第二步(必填): 联系人、电话、授信额度、标签
  - 第三步(可选): 历史业绩、备注
- **快速录入支持**: 前两步完成即可保存，第三步后续补全

**3. 任务导航设计** (ux-expert + product-manager)
- **工作台到详情**: 任务卡片内嵌分销商摘要信息，点击跳转到分销商详情页
- **详情到任务创建**: 分销商详情页内创建跟进任务按钮

**4. 时间轴视觉实现** (ui-designer + ux-expert)
- **布局方案**: 分组列表，支持折叠/展开控制信息密度
- **分组逻辑**: 今日/明日/本周，优先级视觉标识(色条+标签)

### CONFIRMED API集成点

**核心API端点**:
- `POST /api/distributors` - 创建分销商(三步表单提交)
- `GET /api/distributors?owner_id={user_id}` - 查询销售负责的分销商
- `GET /api/distributors` - 领导查询所有分销商(无权限过滤)
- `POST /api/tasks` - 创建跟进任务(从分销商详情页触发)
- `GET /api/tasks?user_id={user_id}&date_range={today|tomorrow|week}` - 查询销售任务
- `GET /api/dashboard/stats` - 领导看板统计数据(从Redis读取)

**权限验证逻辑**:
- 中间件验证JWT Token → 解析user_id和role
- 销售角色: 查询自动添加owner_user_id过滤
- 领导角色: 跳过owner_user_id过滤

---

## 风险与约束

### 识别的风险

**1. 事件流存储增长** → 缓解: 定期归档历史事件(保留最近6个月)
- **风险**: 事件表无限增长影响数据库性能
- **监控**: 每月检查事件表大小

**2. Redis缓存失效** → 缓解: 缓存miss时回源数据库实时计算
- **风险**: Redis故障导致看板无法访问
- **降级方案**: 检测Redis不可用时直接查询PostgreSQL

**3. 单机部署单点故障** → 缓解: 定期数据库备份(每日增量+每周全量)
- **风险**: Docker服务器故障导致系统不可用
- **可接受性**: 小团队场景下，短暂故障可接受

**4. 权限过滤遗漏** → 缓解: ORM层封装统一查询方法，强制注入权限条件
- **风险**: 代码漏洞导致数据越权访问
- **预防**: Code Review + 集成测试覆盖权限场景

---

## 下一步行动

**⚠️ 自动继续流程** (当前从auto-parallel调用):
- auto-parallel工作流将自动分配5个conceptual-planning-agent
- 每个选定角色将生成专项分析文档:
  - system-architect → 架构设计详细方案
  - product-manager → 产品功能详细规划
  - ux-expert → 用户体验设计细节
  - data-architect → 数据模型完整设计
  - ui-designer → 视觉设计系统规范
- 各角色agent将读取本guidance-specification.md作为框架上下文

**开发准备工作** (后续手动执行):
1. 技术选型确认: 前端框架(React/Vue)、后端框架(Express/NestJS/FastAPI)
2. 开发环境搭建: Docker环境、代码仓库、CI/CD流程
3. 详细设计: 数据库表结构、API接口规范、UI原型图
4. 任务分解: 按模块拆分开发任务，估算工作量
5. 迭代计划: 制定6-8周开发计划，里程碑和交付物

---

## 附录: 决策追溯表

| 决策ID | 类别 | 问题 | 选定答案 | 阶段 | 理由 |
|--------|------|------|----------|------|------|
| D-001 | 意图 | 使用规模 | 小团队(10-30人) | Phase 1 | 单体架构足够，快速开发 |
| D-002 | 意图 | 核心诉求 | 销售-领导协同工作流 | Phase 1 | 双方协同，任务提醒 |
| D-003 | 意图 | MVP优先级 | 功能完整性一次性交付 | Phase 1 | 需求明确，6-8周可控 |
| D-004 | 意图 | 数据实时性 | 准实时(1-5分钟) | Phase 1 | 平衡性能和复杂度 |
| D-005 | 角色 | 角色选择 | system-architect, product-manager, ux-expert, data-architect, ui-designer | Phase 2 | 全面技术和产品覆盖 |
| D-006 | 架构 | 整体架构 | 前后端分离单体架构 | Phase 3 | 小团队快速开发 |
| D-007 | 架构 | 数据同步 | 定时任务+Redis缓存 | Phase 3 | 简单可靠，满足准实时 |
| D-008 | 架构 | 数据库 | PostgreSQL | Phase 3 | JSON支持，聚合查询强 |
| D-009 | 架构 | 部署 | Docker Compose单机 | Phase 3 | 成本低，快速部署 |
| D-010 | 产品 | 功能范围 | 渠道+看板+权限 | Phase 3 | 满足基本需求 |
| D-011 | 产品 | 工作流 | 任务分配+进度跟踪 | Phase 3 | 协同跟进机制 |
| D-012 | 产品 | 看板指标 | 总数/新增/成交率/区域 | Phase 3 | 宏观统计 |
| D-013 | 产品 | 权限 | 销售看自己/领导看全部 | Phase 3 | 数据隔离 |
| D-014 | UX | 表单 | 分步表单(三步) | Phase 3 | 降低认知负担 |
| D-015 | UX | 任务分配 | 详情页内分配 | Phase 3 | 决策准确 |
| D-016 | UX | 看板展示 | 数据表格+筛选器 | Phase 3 | 支持下钻分析 |
| D-017 | UX | 销售工作台 | 任务优先视图 | Phase 3 | 以待办为核心 |
| D-018 | 数据 | 分销商模型 | 扩展模型 | Phase 3 | 精细化管理 |
| D-019 | 数据 | 任务关联 | 事件流模型 | Phase 3 | 审计日志完整 |
| D-020 | 数据 | 看板计算 | 定时聚合到Redis | Phase 3 | 查询性能优化 |
| D-021 | 数据 | 权限过滤 | 应用层WHERE过滤 | Phase 3 | 灵活可控 |
| D-022 | UI | 视觉风格 | 清爽简约风格 | Phase 3 | 适合长时间使用 |
| D-023 | UI | 步骤指示器 | 顶部横向步骤条 | Phase 3 | 标准设计 |
| D-024 | UI | 表格样式 | 标准表格+筛选器+分页 | Phase 3 | 企业标准方案 |
| D-025 | UI | 任务布局 | 时间轴视图 | Phase 3 | 时间顺序清晰 |
| D-026 | 整合 | 事件流定位 | 仅用于审计日志 | Phase 4 | 职责分离 |
| D-027 | 整合 | 表单字段分布 | 第1步必填基础/第2步联系和合作/第3步可选业绩 | Phase 4 | 支持快速录入 |
| D-028 | 整合 | 任务导航 | 任务卡片跳转详情页 | Phase 4 | 标准流程 |
| D-029 | 整合 | 时间轴呈现 | 分组列表(折叠/展开) | Phase 4 | 控制信息密度 |

---

**文档版本**: v1.0
**状态**: 已确认
**下一步**: 等待auto-parallel分配角色agent执行分析任务
